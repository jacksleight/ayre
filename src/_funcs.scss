/* Sizes */

@function ayre-sizes($auto: null, $sizes: null) {
    @if type-of($auto) == map {
        $sizes: $auto;
        $auto: null;
    }
    @if $sizes == null {
        $sizes: ();
    }
    $parsed: ();
    @if $auto != null {
        $span:  ayre-span($auto);
        $total: ayre-span-total($span);
        @for $i from $total * 2 through $ayre-limit {
            @if unitless($total) == false or $i % $total == 0 {
                $parsed: map-merge($parsed, ($i to 0 auto: (null: $span)));
            }
        }
    }
    @each $range, $selectors in $sizes {
        $range: ayre-range($range);
        @if $selectors == null {
            @if map-has-key($parsed, $range) {
                $parsed: map-remove($parsed, $range);
            }
        } @else {
            @if type-of($selectors) != map and length($selectors) > 0 {
                $selectors: (null: $selectors);
            }
            $parsed: map-merge($parsed, ($range: $selectors));
        }
    }
    @return $parsed;
}

/* Points */

@function ayre-points() {
    $gutters-x: ayre-gutters-x($ayre-gutters);
    @if $gutters-x == null {
        $gutters-x: 0;
    }
    $measures: ();
    @for $i from 1 through $ayre-limit {
        $measure:
            ($ayre-basis * $i) +
            ($gutters-x * ($i - 1)) +
            $ayre-extra;
        $measures: append($measures, $measure);
    }
    $points: ();
    @for $i from 1 through $ayre-limit {
        $min: nth($measures, $i);
        $max: 0;
        @if length($measures) > $i {
            $max: nth($measures, $i + 1) - 1;
        }
        $points: map-merge($points, ($i: $min $max));
    }
    @return $points;
}

/* Measure */

@function ayre-measure-min($measure) {
    $value: nth($measure, 1);
    @if $value == 0 {
        @return null;
    }
    @return $value;
}
@function ayre-measure-max($measure) {
    $value: nth($measure, 2);
    @if $value == 0 {
        @return null;
    }
    @return $value;
}

/* Span */

@function ayre-span($span) {
    @if $span == null {
        @return null;
    }
    $width: 0;
    $left:  0;
    $right: 0;
    $size:  $ayre-limit;
    $break: false;
    @for $i from 1 through length($span) {
        @if $break == false {
            @if nth($span, $i) == of {
                $size: nth($span, $i + 1);
                $break: true;
            } @elseif $i == 1 {
                $width: nth($span, $i);
            } @elseif $i == 2 {
                $left: nth($span, $i);
            } @elseif $i == 3 {
                $right: nth($span, $i);
            }
        }
    }
    $span: $width $left $right of $size;
    @return $span;
}
@function ayre-span-width($span) {
    $value: nth($span, 1);
    @if $value == 0 {
        @return null;
    }
    @return $value;
}
@function ayre-span-left($span) {
    $value: nth($span, 2);
    @if $value == 0 {
        @return null;
    }
    @return $value;
}
@function ayre-span-right($span) {
    $value: nth($span, 3);
    @if $value == 0 {
        @return null;
    }
    @return $value;
}
@function ayre-span-size($span) {
    $value: nth($span, 5);
    @if $value == 0 {
        @return null;
    }
    @return $value;
}
@function ayre-span-total($span) {
    $value: nth($span, 1) + nth($span, 2) + nth($span, 3);
    @if $value == 0 {
        @return null;
    }
    @return $value;
}
@function ayre-span-length($span, $range, $length) {
    @if $length == null {
        @return null;
    }
    @if unitless($length) {
        $range-min: ayre-range-min($range);
        $scale:     $ayre-limit / ayre-span-size($span);
        $length:    percentage(1 / ($range-min / ($length * $scale)));
    }
    @return $length;
}
@function ayre-span-width-length($span, $range) {
    $span: ayre-span($span);
    @return ayre-span-length($span, $range, ayre-span-width($span));
}
@function ayre-span-left-length($span, $range) {
    $span: ayre-span($span);
    @return ayre-span-length($span, $range, ayre-span-left($span));
}
@function ayre-span-right-length($span, $range) {
    $span: ayre-span($span);
    @return ayre-span-length($span, $range, ayre-span-right($span));
}

/* Range */

@function ayre-range($range) {
    @if $range == null {
        @return null;
    }
    $min:   1;
    $max:   0;
    $type:  user;
    $break: false;
    @for $i from 1 through length($range) {
        @if $break == false {
            @if nth($range, $i) == user or nth($range, $i) == auto {
                $type: nth($range, $i);
                $break: true;
            } @elseif $i == 1 {
                $min: nth($range, $i);
            } @elseif $i == 3 {
                $max: nth($range, $i);
            }
        }
    }
    $range: $min to $max $type;
    @return $range;
}
@function ayre-range-min($range) {
    $value: nth($range, 1);
    @if $value == 0 {
        @return null;
    }
    @return $value;
}
@function ayre-range-max($range) {
    $value: nth($range, 3);
    @if $value == 0 {
        @return null;
    }
    @return $value;
}

/* Gutters */

@function ayre-gutters($gutters) {
    @if $gutters == null {
        $gutters: $ayre-gutters;
    }
    @if length($gutters) == 1 {
        $gutters: append($gutters, nth($gutters, 1));
    }
    @return $gutters;
}
@function ayre-gutters-x($gutters) {
    $value: nth($gutters, 1);
    @if $value == 0 {
        @return null;
    }
    @return $value;
}
@function ayre-gutters-y($gutters) {
    $value: nth($gutters, 2);
    @if $value == 0 {
        @return null;
    }
    @return $value;
}